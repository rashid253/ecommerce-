<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Panel – Content Editor</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <!-- Bootstrap and Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Global & Layout */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; display: flex; height: 100vh; overflow: hidden; }
    .wrapper { display: flex; width: 100%; }
    /* Sidebar */
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: #ecf0f1;
      padding: 20px;
      transition: transform 0.3s ease;
    }
    .sidebar h2 { margin-bottom: 20px; font-size: 1.3rem; }
    .sidebar ul { list-style: none; }
    .sidebar ul li {
      padding: 10px 15px;
      margin-bottom: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .sidebar ul li.active, .sidebar ul li:hover {
      background: #34495e;
    }
    /* Main Content */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .top-navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .toggle-btn { font-size: 1.5rem; cursor: pointer; display: none; }
    /* Mobile adjustments */
    @media (max-width: 767.98px) {
      .sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); z-index: 1050; }
      .sidebar.open { transform: translateX(0); }
      .toggle-btn { display: block; }
      .content { margin-left: 0; }
    }
    /* Content Section */
    .content-section { margin-top: 20px; }
    .d-none { display: none !important; }
    .form-group { margin-bottom: 15px; }
    .form-check { margin-bottom: 5px; }
  </style>
</head>
<body>
  <!-- Mobile menu toggle -->
  <button class="toggle-btn" id="menuToggle"><i class="fas fa-bars"></i></button>
  
  <div class="wrapper">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <h2>Admin Panel</h2>
      <ul id="pagesList">
        <!-- Populated via script -->
      </ul>
    </nav>
    
    <!-- Main Content Area -->
    <div class="content">
      <div class="top-navbar">
        <h4 id="pageTitle">Dashboard</h4>
        <div>
          <button class="btn btn-outline-secondary btn-sm"><i class="fas fa-user"></i> Admin</button>
          <button class="btn btn-outline-danger btn-sm"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
      
      <div id="main-content">
        <!-- Home Page Editing -->
        <div id="home" class="content-section d-none">
          <h4>Home Page Content</h4>
          <form id="homeForm">
            <div class="form-group">
              <label for="homeHeroTitle">Hero Title</label>
              <input type="text" class="form-control" id="homeHeroTitle" placeholder="Enter hero title">
            </div>
            <div class="form-group">
              <label for="homeHeroDesc">Hero Description</label>
              <textarea class="form-control" id="homeHeroDesc" rows="3" placeholder="Enter hero description"></textarea>
            </div>
            <div class="form-group">
              <label>Background Media Options</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionURL" value="url" checked>
                <label class="form-check-label" for="heroOptionURL">Manual URL</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionUpload" value="upload">
                <label class="form-check-label" for="heroOptionUpload">Direct Upload</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionDefault" value="default">
                <label class="form-check-label" for="heroOptionDefault">Use Default</label>
              </div>
            </div>
            <!-- Manual URL Field -->
            <div class="form-group" id="heroURLField">
              <label for="homeMediaURL">Background Media URL</label>
              <input type="text" class="form-control" id="homeMediaURL" placeholder="Enter media URL">
            </div>
            <!-- Direct Upload Field -->
            <div class="form-group d-none" id="heroUploadField">
              <label for="homeMediaFile">Upload Background Media</label>
              <input type="file" id="homeMediaFile" accept="image/*">
              <small>The image will be auto-resized (max 1920×1080) and uploaded via Imgur.</small>
            </div>
            <!-- Default Option Message -->
            <div class="form-group d-none" id="heroDefaultField">
              <p class="text-muted">Default background media will be used.</p>
            </div>
            <button type="submit" class="btn btn-primary">Save Home Content</button>
          </form>
        </div>
        
        <!-- E-commerce Editing -->
        <div id="ecommerce" class="content-section d-none">
          <h4>E-commerce Page Content</h4>
          <form id="ecommerceForm">
            <div class="form-group">
              <label for="ecomPageTitle">Page Title</label>
              <input type="text" class="form-control" id="ecomPageTitle" placeholder="Enter page title">
            </div>
            <div class="form-group">
              <label for="ecomHeroSubtitle">Hero Subtitle</label>
              <input type="text" class="form-control" id="ecomHeroSubtitle" placeholder="Enter hero subtitle">
            </div>
            <div class="form-group">
              <label>Products List</label>
              <div id="productsContainer"></div>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addProductBtn">
                <i class="fas fa-plus"></i> Add Product
              </button>
            </div>
            <button type="submit" class="btn btn-primary">Save E-commerce Content</button>
          </form>
        </div>
        
        <!-- Offers Editing -->
        <div id="offers" class="content-section d-none">
          <h4>Offers Page Content</h4>
          <form id="offersForm">
            <div class="form-group">
              <label for="offersPageTitle">Page Title</label>
              <input type="text" class="form-control" id="offersPageTitle" placeholder="Enter page title">
            </div>
            <div class="form-group">
              <label for="offersDesc">Description</label>
              <textarea class="form-control" id="offersDesc" rows="3" placeholder="Enter description"></textarea>
            </div>
            <div class="form-group">
              <label>Offers Items</label>
              <div id="offersContainer"></div>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addOfferBtn">
                <i class="fas fa-plus"></i> Add Offer
              </button>
            </div>
            <button type="submit" class="btn btn-primary">Save Offers Content</button>
          </form>
        </div>
        
        <!-- Payments Editing -->
        <div id="payments" class="content-section d-none">
          <h4>Payments Page Content</h4>
          <form id="paymentsForm">
            <div class="form-group">
              <label for="paymentsPageTitle">Page Title</label>
              <input type="text" class="form-control" id="paymentsPageTitle" placeholder="Enter page title">
            </div>
            <div class="form-group">
              <label for="paymentsDesc">Description</label>
              <textarea class="form-control" id="paymentsDesc" rows="3" placeholder="Enter description"></textarea>
            </div>
            <div class="form-group">
              <label>Payment Details</label>
              <div id="paymentsContainer"></div>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addPaymentBtn">
                <i class="fas fa-plus"></i> Add Payment Detail
              </button>
            </div>
            <button type="submit" class="btn btn-primary">Save Payments Content</button>
          </form>
        </div>
        
        <!-- Support Editing -->
        <div id="support" class="content-section d-none">
          <h4>Support Page Content</h4>
          <form id="supportForm">
            <div class="form-group">
              <label for="supportPageTitle">Page Title</label>
              <input type="text" class="form-control" id="supportPageTitle" placeholder="Enter page title">
            </div>
            <div class="form-group">
              <label for="supportSubtitle">Subtitle</label>
              <input type="text" class="form-control" id="supportSubtitle" placeholder="Enter subtitle">
            </div>
            <div class="form-group">
              <label>FAQ Items</label>
              <div id="faqContainer"></div>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addFaqBtn">
                <i class="fas fa-plus"></i> Add FAQ
              </button>
            </div>
            <button type="submit" class="btn btn-primary">Save Support Content</button>
          </form>
        </div>
        
        <!-- Product Details Editing -->
        <div id="productDetails" class="content-section d-none">
          <h4>Product Details Content</h4>
          <form id="productDetailsForm">
            <div class="form-group">
              <label for="prodName">Product Name</label>
              <input type="text" class="form-control" id="prodName" placeholder="Enter product name">
            </div>
            <!-- For Product Image, provide two options -->
            <div class="form-group">
              <label>Product Image Options</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="prodImageOption" id="prodOptionUpload" value="upload" checked>
                <label class="form-check-label" for="prodOptionUpload">Direct Upload</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="prodImageOption" id="prodOptionDefault" value="default">
                <label class="form-check-label" for="prodOptionDefault">Use Default</label>
              </div>
            </div>
            <!-- Read-only field for the image URL -->
            <div class="form-group" id="prodURLField">
              <label for="prodImageUrl">Product Image URL</label>
              <input type="text" class="form-control" id="prodImageUrl" placeholder="Image URL will appear here" readonly>
            </div>
            <!-- File input for direct upload (only shown if "Direct Upload" is selected) -->
            <div class="form-group" id="prodUploadField">
              <label for="prodImageFile">Upload Product Image</label>
              <input type="file" id="prodImageFile" accept="image/*">
              <small>The image will be auto-resized (max 400×300) and uploaded via Imgur.</small>
            </div>
            <div class="form-group">
              <label for="prodPrice">Price</label>
              <input type="number" class="form-control" id="prodPrice" placeholder="Enter price">
            </div>
            <div class="form-group">
              <label for="prodDiscount">Discount (%)</label>
              <input type="number" class="form-control" id="prodDiscount" placeholder="Enter discount">
            </div>
            <div class="form-group">
              <label for="prodRating">Rating</label>
              <input type="number" class="form-control" id="prodRating" placeholder="Enter rating">
            </div>
            <div class="form-group">
              <label for="prodAdded">Added Count</label>
              <input type="number" class="form-control" id="prodAdded" placeholder="Enter added count">
            </div>
            <div class="form-group">
              <label for="prodSold">Sold Count</label>
              <input type="number" class="form-control" id="prodSold" placeholder="Enter sold count">
            </div>
            <div class="form-group">
              <label for="prodDesc">Description</label>
              <textarea class="form-control" id="prodDesc" rows="3" placeholder="Enter product description"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Product Details</button>
          </form>
        </div>
        
        <!-- Header Editing -->
        <div id="header" class="content-section d-none">
          <h4>Header Content</h4>
          <form id="headerForm">
            <div class="form-group">
              <label for="logoIcon">Logo Icon Class</label>
              <input type="text" class="form-control" id="logoIcon" placeholder='e.g. "fas fa-briefcase"'>
            </div>
            <div class="form-group">
              <label for="searchPlaceholder">Search Placeholder</label>
              <input type="text" class="form-control" id="searchPlaceholder" placeholder="Enter search placeholder">
            </div>
            <div class="form-group">
              <label for="supportLink">Support Link URL</label>
              <input type="text" class="form-control" id="supportLink" placeholder="Enter support link URL">
            </div>
            <button type="submit" class="btn btn-primary">Save Header Content</button>
          </form>
        </div>
        
        <!-- Footer Editing -->
        <div id="footer" class="content-section d-none">
          <h4>Footer Content</h4>
          <form id="footerForm">
            <div class="form-group">
              <label>Footer Links</label>
              <div id="footerLinksContainer"></div>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addFooterLinkBtn">
                <i class="fas fa-plus"></i> Add Footer Link
              </button>
            </div>
            <div class="form-group">
              <label for="copyrightText">Copyright Text</label>
              <input type="text" class="form-control" id="copyrightText" placeholder="Enter copyright text">
            </div>
            <button type="submit" class="btn btn-primary">Save Footer Content</button>
          </form>
        </div>
        
        <!-- Business Card Section Removed -->
      </div>
    </div>
  </div>
  
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Firebase configuration (ensure these values match your project)
    const firebaseConfig = {
      apiKey: "AIzaSyBq9eDQru5rMMXZjQ4RYHcKSGkcgnnDJFw",
      authDomain: "e-commerce-pk.firebaseapp.com",
      projectId: "e-commerce-pk",
      storageBucket: "e-commerce-pk.firebasestorage.app",
      messagingSenderId: "126517093225",
      appId: "1:126517093225:web:c2352620c6d32c582513f8",
      measurementId: "G-2G2DNCNNT3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    
    // Sidebar navigation – pages list
    const pages = ["home", "ecommerce", "offers", "payments", "support", "productDetails", "header", "footer"];
    function renderPagesList() {
      const pagesList = document.getElementById("pagesList");
      pagesList.innerHTML = "";
      pages.forEach(page => {
        const li = document.createElement("li");
        li.textContent = page;
        li.setAttribute("data-target", page);
        li.addEventListener("click", function() {
          document.querySelectorAll("#pagesList li").forEach(item => item.classList.remove("active"));
          this.classList.add("active");
          loadPageData(this.textContent);
        });
        pagesList.appendChild(li);
      });
    }
    renderPagesList();
    if(pages.length > 0) {
      loadPageData(pages[0]);
      document.querySelector("#pagesList li").classList.add("active");
    }
    
    // Load page data from Firestore (simulate – replace with real Firestore calls)
    function loadPageData(pageId) {
      // For demo, we simply set the page ID in a hidden field.
      // Replace this with Firestore read code as needed.
      document.getElementById("pageTitle").innerText = pageId.charAt(0).toUpperCase() + pageId.slice(1);
      // Additional loading logic goes here.
    }
    
    // Form submission handlers (simulate saving)
    function handleFormSubmit(formId, pageName) {
      document.getElementById(formId).addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => { data[key] = value; });
        alert(pageName + " content saved successfully!");
        console.log(pageName + " Data:", data);
      });
    }
    handleFormSubmit("homeForm", "Home");
    handleFormSubmit("ecommerceForm", "E-commerce");
    handleFormSubmit("offersForm", "Offers");
    handleFormSubmit("paymentsForm", "Payments");
    handleFormSubmit("supportForm", "Support");
    handleFormSubmit("productDetailsForm", "Product Details");
    handleFormSubmit("headerForm", "Header");
    handleFormSubmit("footerForm", "Footer");
    
    // Mobile sidebar toggle
    document.getElementById("menuToggle").addEventListener("click", function() {
      document.getElementById("sidebar").classList.toggle("open");
    });
    document.addEventListener("click", function(e) {
      if(window.innerWidth < 768 && !document.getElementById("sidebar").contains(e.target) && !document.getElementById("menuToggle").contains(e.target)) {
        document.getElementById("sidebar").classList.remove("open");
      }
    });
    
    // Imgur integration for Product Details – Direct Upload (auto-resize max 400x300)
    document.getElementById("prodImageFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      const reader = new FileReader();
      reader.onload = function(event) { img.src = event.target.result; };
      reader.readAsDataURL(file);
      img.onload = function() {
        const MAX_WIDTH = 400, MAX_HEIGHT = 300;
        let width = img.width, height = img.height;
        if (width > height && width > MAX_WIDTH) {
          height = Math.floor((height * MAX_WIDTH) / width);
          width = MAX_WIDTH;
        } else if (height > MAX_HEIGHT) {
          width = Math.floor((width * MAX_HEIGHT) / height);
          height = MAX_HEIGHT;
        }
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height);
        canvas.toBlob(function(blob) {
          const reader2 = new FileReader();
          reader2.onloadend = function() {
            const base64data = reader2.result.split(',')[1];
            const clientId = "048d9400ce02b71";
            const formData = new FormData();
            formData.append("image", base64data);
            fetch("https://api.imgur.com/3/image", {
              method: "POST",
              headers: { Authorization: "Client-ID " + clientId },
              body: formData
            })
            .then(response => response.json())
            .then(result => {
              if (result.success) {
                const imageUrl = result.data.link;
                alert("Product image uploaded successfully!\n" + imageUrl);
                document.getElementById("prodImageUrl").value = imageUrl;
                console.log("Uploaded Product Image URL:", imageUrl);
              } else {
                alert("Product image upload failed: " + result.data.error);
              }
            })
            .catch(error => {
              alert("Error uploading product image: " + error.message);
              console.error("Imgur upload error:", error);
            });
          };
          reader2.readAsDataURL(blob);
        }, "image/jpeg", 0.8);
      };
    });
    
    // Imgur integration for Home hero background – Direct Upload (auto-resize max 1920x1080)
    document.getElementById("homeMediaFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      const reader = new FileReader();
      reader.onload = function(event) { img.src = event.target.result; };
      reader.readAsDataURL(file);
      img.onload = function() {
        const MAX_WIDTH = 1920, MAX_HEIGHT = 1080;
        let width = img.width, height = img.height;
        if (width > height && width > MAX_WIDTH) {
          height = Math.floor((height * MAX_WIDTH) / width);
          width = MAX_WIDTH;
        } else if (height > MAX_HEIGHT) {
          width = Math.floor((width * MAX_HEIGHT) / height);
          height = MAX_HEIGHT;
        }
        const canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, width, height);
        canvas.toBlob(function(blob) {
          const reader2 = new FileReader();
          reader2.onloadend = function() {
            const base64data = reader2.result.split(',')[1];
            const clientId = "048d9400ce02b71";
            const formData = new FormData();
            formData.append("image", base64data);
            fetch("https://api.imgur.com/3/image", {
              method: "POST",
              headers: { Authorization: "Client-ID " + clientId },
              body: formData
            })
            .then(response => response.json())
            .then(result => {
              if (result.success) {
                const imageUrl = result.data.link;
                alert("Hero background image uploaded successfully!\n" + imageUrl);
                // Populate the manual URL field with the uploaded URL
                document.getElementById("homeMediaURL").value = imageUrl;
                console.log("Uploaded Hero Background URL:", imageUrl);
              } else {
                alert("Hero background upload failed: " + result.data.error);
              }
            })
            .catch(error => {
              alert("Error uploading hero background: " + error.message);
              console.error("Imgur hero upload error:", error);
            });
          };
          reader2.readAsDataURL(blob);
        }, "image/jpeg", 0.8);
      };
    });
    
    // Show/hide hero media fields based on selection
    const heroRadios = document.getElementsByName("heroMediaOption");
    heroRadios.forEach(radio => {
      radio.addEventListener("change", function() {
        if (this.value === "url") {
          document.getElementById("heroURLField").classList.remove("d-none");
          document.getElementById("heroUploadField").classList.add("d-none");
          document.getElementById("heroDefaultField").classList.add("d-none");
        } else if (this.value === "upload") {
          document.getElementById("heroURLField").classList.add("d-none");
          document.getElementById("heroUploadField").classList.remove("d-none");
          document.getElementById("heroDefaultField").classList.add("d-none");
        } else if (this.value === "default") {
          document.getElementById("heroURLField").classList.add("d-none");
          document.getElementById("heroUploadField").classList.add("d-none");
          document.getElementById("heroDefaultField").classList.remove("d-none");
        }
      });
    });
    
    // For product image option, show/hide upload field
    const prodRadios = document.getElementsByName("prodImageOption");
    prodRadios.forEach(radio => {
      radio.addEventListener("change", function() {
        if (this.value === "upload") {
          document.getElementById("prodUploadField").classList.remove("d-none");
          document.getElementById("prodURLField").classList.remove("d-none");
        } else if (this.value === "default") {
          document.getElementById("prodUploadField").classList.add("d-none");
          document.getElementById("prodURLField").classList.add("d-none");
          document.getElementById("prodImageUrl").value = "";
        }
      });
    });
  </script>
</body>
</html>
