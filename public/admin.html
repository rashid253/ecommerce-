<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel – Content Editor</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <!-- Bootstrap 5 CSS & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Global Reset & Layout */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { height: 100%; }
    body { font-family: Arial, sans-serif; display: flex; flex-direction: column; }
    /* Top Bar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #fff;
      padding: 10px 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }
    .topbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .hamburger {
      font-size: 1.5rem;
      cursor: pointer;
      color: #2c3e50;
    }
    .topbar-center {
      flex: 1;
      text-align: center;
      font-size: 1rem;
      font-weight: bold;
    }
    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    /* Wrapper for sidebar + content */
    .wrapper {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    /* Sidebar */
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: #ecf0f1;
      padding: 15px;
      transition: transform 0.3s ease;
    }
    .sidebar h2 { margin-bottom: 15px; font-size: 1.2rem; }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar li {
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    .sidebar li i { margin-right: 8px; }
    .sidebar li:hover, .sidebar li.active { background: #34495e; }
    /* Content Area */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }
    /* Mobile - hide sidebar by default */
    @media (max-width: 767.98px) {
      .sidebar {
        position: fixed;
        top: 60px; /* Below topbar */
        left: 0;
        height: calc(100% - 60px);
        transform: translateX(-100%);
        z-index: 2000;
      }
      .sidebar.open { transform: translateX(0); }
    }
    /* Content Sections */
    .content-section { display: none; margin-top: 10px; }
    .content-section.active { display: block; }
    .form-group { margin-bottom: 15px; }
    .form-check { margin-bottom: 5px; }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-left">
      <i class="fas fa-bars hamburger" id="hamburger"></i>
    </div>
    <div class="topbar-center" id="pageTitle">Dashboard</div>
    <div class="topbar-right">
      <button class="btn btn-outline-secondary btn-sm"><i class="fas fa-user"></i> Admin</button>
      <button class="btn btn-outline-danger btn-sm"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
  </div>
  
  <!-- Wrapper -->
  <div class="wrapper">
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <h2>Admin Panel</h2>
      <ul id="pagesList">
        <!-- Populated via script below -->
      </ul>
    </nav>
    
    <!-- Main Content -->
    <div class="content" id="mainContent">
      <!-- Home Section -->
      <div id="home" class="content-section">
        <h4>Home Page Content</h4>
        <form id="homeForm">
          <div class="form-group">
            <label for="homeHeroTitle">Hero Title</label>
            <input type="text" class="form-control" id="homeHeroTitle" placeholder="Enter hero title">
          </div>
          <div class="form-group">
            <label for="homeHeroDesc">Hero Description</label>
            <textarea class="form-control" id="homeHeroDesc" rows="3" placeholder="Enter hero description"></textarea>
          </div>
          <div class="form-group">
            <label>Background Media Options</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionURL" value="url" checked>
              <label class="form-check-label" for="heroOptionURL">Manual URL</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionUpload" value="upload">
              <label class="form-check-label" for="heroOptionUpload">Direct Upload</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="heroMediaOption" id="heroOptionDefault" value="default">
              <label class="form-check-label" for="heroOptionDefault">Use Default</label>
            </div>
          </div>
          <!-- Manual URL field -->
          <div class="form-group" id="heroURLField">
            <label for="homeMediaURL">Background Media URL</label>
            <input type="text" class="form-control" id="homeMediaURL" placeholder="Enter media URL">
          </div>
          <!-- Direct Upload field -->
          <div class="form-group d-none" id="heroUploadField">
            <label for="homeMediaFile">Upload Background Media</label>
            <input type="file" id="homeMediaFile" accept="image/*">
            <small>Auto-resized (max 1920×1080) & uploaded via Imgur.</small>
          </div>
          <!-- Default message -->
          <div class="form-group d-none" id="heroDefaultField">
            <p class="text-muted">Default background media will be used.</p>
          </div>
          <button type="submit" class="btn btn-primary">Save Home Content</button>
        </form>
      </div>
      
      <!-- Product Details Section -->
      <div id="productDetails" class="content-section">
        <h4>Product Details</h4>
        <form id="productDetailsForm">
          <div class="form-group">
            <label for="prodName">Product Name</label>
            <input type="text" class="form-control" id="prodName" placeholder="Enter product name">
          </div>
          <div class="form-group">
            <label>Product Image Options</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="prodImageOption" id="prodOptionUpload" value="upload" checked>
              <label class="form-check-label" for="prodOptionUpload">Direct Upload</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="prodImageOption" id="prodOptionDefault" value="default">
              <label class="form-check-label" for="prodOptionDefault">Use Default</label>
            </div>
          </div>
          <!-- Product image URL field (read-only) -->
          <div class="form-group" id="prodURLField">
            <label for="prodImageUrl">Product Image URL</label>
            <input type="text" class="form-control" id="prodImageUrl" placeholder="Image URL will appear here" readonly>
          </div>
          <!-- Direct Upload field -->
          <div class="form-group" id="prodUploadField">
            <label for="prodImageFile">Upload Product Image</label>
            <input type="file" id="prodImageFile" accept="image/*">
            <small>Auto-resized (max 400×300) & uploaded via Imgur.</small>
          </div>
          <div class="form-group">
            <label for="prodPrice">Price</label>
            <input type="number" class="form-control" id="prodPrice" placeholder="Enter price">
          </div>
          <div class="form-group">
            <label for="prodDiscount">Discount (%)</label>
            <input type="number" class="form-control" id="prodDiscount" placeholder="Enter discount">
          </div>
          <div class="form-group">
            <label for="prodRating">Rating</label>
            <input type="number" class="form-control" id="prodRating" placeholder="Enter rating">
          </div>
          <div class="form-group">
            <label for="prodAdded">Added Count</label>
            <input type="number" class="form-control" id="prodAdded" placeholder="Enter added count">
          </div>
          <div class="form-group">
            <label for="prodSold">Sold Count</label>
            <input type="number" class="form-control" id="prodSold" placeholder="Enter sold count">
          </div>
          <div class="form-group">
            <label for="prodDesc">Description</label>
            <textarea class="form-control" id="prodDesc" rows="3" placeholder="Enter product description"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Save Product Details</button>
        </form>
      </div>
      <!-- Add other sections (ecommerce, offers, payments, support, header, footer) similarly -->
    </div>
  </div>
  
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Firebase config – replace with your own project values if needed
    const firebaseConfig = {
      apiKey: "AIzaSyBq9eDQru5rMMXZjQ4RYHcKSGkcgnnDJFw",
      authDomain: "e-commerce-pk.firebaseapp.com",
      projectId: "e-commerce-pk",
      storageBucket: "e-commerce-pk.appspot.com",
      messagingSenderId: "126517093225",
      appId: "1:126517093225:web:c2352620c6d32c582513f8",
      measurementId: "G-2G2DNCNNT3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Mobile hamburger toggle
    const hamburger = document.getElementById("hamburger");
    const sidebar = document.getElementById("sidebar");
    hamburger.addEventListener("click", function() {
      sidebar.classList.toggle("open");
    });
    document.addEventListener("click", function(e) {
      if(window.innerWidth < 768 && !sidebar.contains(e.target) && !hamburger.contains(e.target)) {
        sidebar.classList.remove("open");
      }
    });
    
    // Pages list in sidebar
    const pages = ["home", "ecommerce", "offers", "payments", "support", "productDetails", "header", "footer"];
    function renderPagesList() {
      const pagesList = document.getElementById("pagesList");
      pagesList.innerHTML = "";
      pages.forEach(page => {
        const li = document.createElement("li");
        li.innerHTML = `<i class="fas fa-angle-right"></i> ${page}`;
        li.dataset.target = page;
        li.addEventListener("click", function() {
          // Set active
          document.querySelectorAll("#pagesList li").forEach(item => item.classList.remove("active"));
          this.classList.add("active");
          // Update page title
          document.getElementById("pageTitle").innerText = page;
          // Show correct section
          document.querySelectorAll(".content-section").forEach(section => section.classList.remove("active"));
          document.querySelectorAll(".content-section").forEach(section => section.classList.add("d-none"));
          document.getElementById(page).classList.add("active");
          document.getElementById(page).classList.remove("d-none");
          // Close sidebar on mobile
          if(window.innerWidth < 768) sidebar.classList.remove("open");
        });
        pagesList.appendChild(li);
      });
    }
    renderPagesList();
    // By default, show the first page
    document.querySelector("#pagesList li").classList.add("active");
    document.getElementById(pages[0]).classList.add("active");
    document.getElementById(pages[0]).classList.remove("d-none");
    document.getElementById("pageTitle").innerText = pages[0];
    
    // Form submission simulation (replace with real Firestore calls if needed)
    function handleFormSubmit(formId, pageName) {
      document.getElementById(formId).addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => { data[key] = value; });
        alert(`${pageName} content saved successfully!`);
        console.log(`${pageName} Data:`, data);
      });
    }
    handleFormSubmit("homeForm", "Home");
    handleFormSubmit("productDetailsForm", "Product Details");
    
    // Show/hide hero media fields
    const heroOptions = document.getElementsByName("heroMediaOption");
    heroOptions.forEach(radio => {
      radio.addEventListener("change", function() {
        document.getElementById("heroURLField").classList.add("d-none");
        document.getElementById("heroUploadField").classList.add("d-none");
        document.getElementById("heroDefaultField").classList.add("d-none");
        if(this.value === "url") {
          document.getElementById("heroURLField").classList.remove("d-none");
        } else if(this.value === "upload") {
          document.getElementById("heroUploadField").classList.remove("d-none");
        } else {
          document.getElementById("heroDefaultField").classList.remove("d-none");
        }
      });
    });
    
    // Show/hide product image fields
    const prodOptions = document.getElementsByName("prodImageOption");
    prodOptions.forEach(radio => {
      radio.addEventListener("change", function() {
        document.getElementById("prodUploadField").classList.add("d-none");
        document.getElementById("prodURLField").classList.add("d-none");
        document.getElementById("prodImageUrl").value = "";
        if(this.value === "upload") {
          document.getElementById("prodUploadField").classList.remove("d-none");
          document.getElementById("prodURLField").classList.remove("d-none");
        }
      });
    });
    
    // Imgur integration for Product Image (max 400×300)
    document.getElementById("prodImageFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if(!file) return;
      const img = new Image();
      const reader = new FileReader();
      reader.onload = ev => { img.src = ev.target.result; };
      reader.readAsDataURL(file);
      img.onload = function() {
        const MAX_W = 400, MAX_H = 300;
        let w = img.width, h = img.height;
        if(w > h && w > MAX_W) { h = Math.floor(h*MAX_W/w); w = MAX_W; }
        else if(h > MAX_H) { w = Math.floor(w*MAX_H/h); h = MAX_H; }
        const canvas = document.createElement("canvas");
        canvas.width = w; canvas.height = h;
        canvas.getContext("2d").drawImage(img, 0, 0, w, h);
        canvas.toBlob(blob => {
          const r2 = new FileReader();
          r2.onloadend = () => {
            const base64data = r2.result.split(',')[1];
            fetch("https://api.imgur.com/3/image", {
              method: "POST",
              headers: { Authorization: "Client-ID 048d9400ce02b71" },
              body: new FormData().append("image", base64data)
            })
            .then(res => res.json())
            .then(result => {
              if(result.success) {
                alert("Product image uploaded!\n" + result.data.link);
                document.getElementById("prodImageUrl").value = result.data.link;
              } else {
                alert("Upload failed: " + result.data.error);
              }
            })
            .catch(err => alert("Error uploading product image: " + err.message));
          };
          r2.readAsDataURL(blob);
        }, "image/jpeg", 0.8);
      };
    });
    
    // Imgur integration for Home hero background (max 1920×1080)
    document.getElementById("homeMediaFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if(!file) return;
      const img = new Image();
      const reader = new FileReader();
      reader.onload = ev => { img.src = ev.target.result; };
      reader.readAsDataURL(file);
      img.onload = function() {
        const MAX_W = 1920, MAX_H = 1080;
        let w = img.width, h = img.height;
        if(w > h && w > MAX_W) { h = Math.floor(h*MAX_W/w); w = MAX_W; }
        else if(h > MAX_H) { w = Math.floor(w*MAX_H/h); h = MAX_H; }
        const canvas = document.createElement("canvas");
        canvas.width = w; canvas.height = h;
        canvas.getContext("2d").drawImage(img, 0, 0, w, h);
        canvas.toBlob(blob => {
          const r2 = new FileReader();
          r2.onloadend = () => {
            const base64data = r2.result.split(',')[1];
            fetch("https://api.imgur.com/3/image", {
              method: "POST",
              headers: { Authorization: "Client-ID 048d9400ce02b71" },
              body: new FormData().append("image", base64data)
            })
            .then(res => res.json())
            .then(result => {
              if(result.success) {
                alert("Hero background uploaded!\n" + result.data.link);
                document.getElementById("homeMediaURL").value = result.data.link;
              } else {
                alert("Upload failed: " + result.data.error);
              }
            })
            .catch(err => alert("Error uploading hero image: " + err.message));
          };
          r2.readAsDataURL(blob);
        }, "image/jpeg", 0.8);
      };
    });
  </script>
</body>
</html>
